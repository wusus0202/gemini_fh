<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ³å’Œç’°å¢ƒç›£æ¸¬ç³»çµ± - å®Œæˆç‰ˆ</title>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18",
        "react-dom": "https://esm.sh/react-dom@18",
        "@google/genai": "https://esm.sh/@google/genai"
      }
    }
    </script>
    <style>
        /* ç›´æ¥æ•´åˆä½ åŸæœ¬æœ€æ¼‚äº®çš„ index.css æ¨£å¼ */
        :root {
            --sidebar-bg: #4a4545; --header-bg: #d9cecd; --main-bg: #f2f2f2;
            --card-bg: #e8e8e8; --accent-red: #ff4444;
        }
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: system-ui, sans-serif; background: var(--main-bg); overflow: hidden; }
        
        .header { height: 70px; background: var(--header-bg); display: flex; align-items: center; padding: 0 24px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .app-container { display: flex; height: calc(100vh - 70px); }
        
        /* å´é‚Šæ¬„æ¨£å¼ */
        .sidebar { width: 280px; background: var(--sidebar-bg); color: white; padding: 24px; display: flex; flex-direction: column; gap: 20px; }
        .location-box { background: white; color: #333; padding: 12px; border-radius: 12px; cursor: pointer; text-align: center; font-weight: bold; }
        .menu-item { padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); font-size: 14px; text-align: center; }

        /* æ™‚é˜æ¨£å¼ */
        .clock-container { margin-top: auto; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 16px; display: flex; align-items: center; gap: 15px; }
        .analog-clock { width: 60px; height: 60px; border: 2px solid white; border-radius: 50%; position: relative; }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; background: white; border-radius: 4px; }
        .hour-hand { width: 4px; height: 15px; }
        .min-hand { width: 2px; height: 22px; }

        /* ä¸»ç•«é¢å¡ç‰‡ */
        .main-content { flex: 1; padding: 32px; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: auto auto; gap: 20px; overflow-y: auto; }
        .card { background: var(--card-bg); border-radius: 24px; padding: 24px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .pm25-card { grid-column: 1 / 3; }
        .value { font-size: 48px; font-weight: bold; color: #333; }
        .ai-insight { grid-column: 1 / 4; background: white; border-left: 8px solid var(--sidebar-bg); padding: 20px; text-align: left; align-items: flex-start; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'react';
        import ReactDOM from 'react-dom';
        import { GoogleGenAI } from '@google/genai';

        // ğŸš¨ é‡è¦ï¼šè«‹å°‡æ­¤è™•æ›æˆä½ çš„ API Key æˆ–åœ¨ Vercel è¨­å®šç’°å¢ƒè®Šæ•¸
        const API_KEY = "ä½ çš„_GEMINI_API_KEY";

        function App() {
            const [pm25, setPm25] = useState('--');
            const [time, setTime] = useState(new Date());
            const [aiText, setAiText] = useState('æ­£åœ¨è«‹ Gemini AI åˆ†ææ•¸æ“š...');

            // æŠ“å– LASS æ•¸æ“š
            useEffect(() => {
                const fetchData = async () => {
                    try {
                        const res = await fetch('https://pm25.lass-net.org/data/last.php?device_id=B827EBC2994D');
                        const data = await res.json();
                        const val = data.s_d0 || 0;
                        setPm25(val);
                        getAIInsight(val);
                    } catch (e) { console.error("æ•¸æ“šæŠ“å–å¤±æ•—", e); }
                };
                fetchData();
                const timer = setInterval(fetchData, 60000);
                return () => clearInterval(timer);
            }, []);

            // AI åˆ†æ
            const getAIInsight = async (val) => {
                if (API_KEY === "ä½ çš„_GEMINI_API_KEY") {
                    setAiText("å°šæœªè¨­å®š API Keyï¼Œç„¡æ³•æä¾› AI å»ºè­°ã€‚");
                    return;
                }
                try {
                    const genAI = new GoogleGenAI(API_KEY);
                    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                    const result = await model.generateContent(`PM2.5 æŒ‡æ•¸ç‚º ${val}ï¼Œè«‹çµ¦èŠ³å’Œå¯¦é©—ä¸­å­¸çš„å­¸ç”Ÿä¸€å¥ç°¡çŸ­çš„æ ¡åœ’å¥åº·æé†’ã€‚`);
                    setAiText(result.response.text());
                } catch (e) { setAiText("AI æš«æ™‚ä¼‘æ¯ä¸­..."); }
            };

            // æ™‚é˜é‚è¼¯
            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const h = time.getHours() % 12;
            const m = time.getMinutes();

            return React.createElement('div', { className: 'app-root' },
                React.createElement('header', { className: 'header' }, 'èŠ³å’Œå¯¦é©—ä¸­å­¸ç’°å¢ƒç›£æ¸¬ç³»çµ±'),
                React.createElement('div', { className: 'app-container' },
                    React.createElement('aside', { className: 'sidebar' },
                        React.createElement('div', { className: 'location-box' }, 'ğŸ« å°èŠ³å ‚ â–¼'),
                        React.createElement('div', { className: 'menu-item' }, 'æº«åº¦ 24.5Â°C'),
                        React.createElement('div', { className: 'menu-item' }, 'æ¿•åº¦ 65%'),
                        React.createElement('div', { className: 'clock-container' },
                            React.createElement('div', { className: 'analog-clock' },
                                React.createElement('div', { className: 'hand hour-hand', style: { transform: `rotate(${h * 30 + m * 0.5}deg)` } }),
                                React.createElement('div', { className: 'hand min-hand', style: { transform: `rotate(${m * 6}deg)` } })
                            ),
                            React.createElement('div', { style: { fontSize: '12px' } }, 
                                React.createElement('div', null, time.toLocaleDateString()),
                                React.createElement('div', { style: { fontWeight: 'bold' } }, time.toLocaleTimeString())
                            )
                        )
                    ),
                    React.createElement('main', { className: 'main-content' },
                        React.createElement('div', { className: 'card pm25-card' },
                            React.createElement('div', { style: { color: '#888' } }, 'PM2.5 å³æ™‚æ¿ƒåº¦'),
                            React.createElement('div', { className: 'value' }, pm25),
                            React.createElement('div', { style: { color: '#999' } }, 'Î¼g/mÂ³')
                        ),
                        React.createElement('div', { className: 'card' }, 
                            React.createElement('div', { style: { fontSize: '14px' } }, 'æ—¥ç…§'),
                            React.createElement('div', { className: 'value', style: { fontSize: '24px' } }, '850 W/mÂ²')
                        ),
                        React.createElement('div', { className: 'card ai-insight' },
                            React.createElement('strong', null, 'ğŸ¤– AI ç’°å¢ƒåˆ†æå»ºè­°'),
                            React.createElement('p', { style: { color: '#555', marginTop: '10px' } }, aiText)
                        )
                    )
                )
            );
        }

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
